<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Legal Acts Portal - Правительство</title>
  <style>
    body { max-width: 700px; margin: 20px auto; font-family: Arial, sans-serif; }
    h2 { margin-top: 30px; }
    input, select, textarea, button { width: 100%; padding: 8px; margin: 6px 0; box-sizing: border-box; }
    .hidden { display: none; }
    .doc { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .admin-buttons button { margin-right: 5px; }
    .log-entry { font-size: 12px; border-bottom: 1px solid #ddd; padding: 3px 0; }
  </style>
</head>
<body>

  <h1>Legal Acts Portal</h1>

  <!-- Вход -->
  <div id="loginSection">
    <h2>Вход в систему</h2>
    <label>Логин:</label>
    <input type="text" id="loginInput" placeholder="Введите логин" />
    <label>Пароль:</label>
    <input type="password" id="passwordInput" placeholder="Введите пароль" />
    <button id="loginBtn">Войти</button>
  </div>

  <!-- После входа -->
  <div id="mainSection" class="hidden">
    <div>
      <b>Добро пожаловать! Вы вошли как: <span id="userName"></span> (<span id="userRole"></span>)</b>
      <button id="logoutBtn" style="float:right;">Выйти</button>
    </div>

    <!-- Создание документа (только для Правительства РФ и Президента) -->
    <div id="createDocSection" class="hidden">
      <h2>Регистрация Акта</h2>
      <label>ФИО:</label>
      <input type="text" id="fioInput" placeholder="Фамилия Имя Отчество" />
      <label>Отдел:</label>
      <input type="text" id="departmentInput" placeholder="Отдел" />
      <label>Вид документа:</label>
      <select id="docTypeSelect">
        <option value="Указ">Указ</option>
        <option value="Постановление">Постановление</option>
      </select>
      <label>Название документа:</label>
      <input type="text" id="docNameInput" placeholder="Название документа" />
      <label>Описание (не обязательно):</label>
      <textarea id="docDescInput" rows="3" placeholder="Описание документа"></textarea>
      <label>Файл:</label>
      <input type="file" id="fileInput" />
      <button id="uploadDocBtn">Загрузить документ</button>
      <p id="uploadCode"></p>
    </div>

    <!-- Список документов -->
    <div id="docsSection">
      <h2>Документы</h2>
      <div id="docsList"></div>
    </div>

    <!-- Логи (только для Минюста и Президента) -->
    <div id="logsSection" class="hidden">
      <h2>Логи действий</h2>
      <div id="logsList"></div>
    </div>
  </div>

<script>
  // Жёстко заданные аккаунты
  const ACCOUNTS = {
    "gov-rf": { password: "1234", role: "creator", name: "Правительство РФ" },
    "minjust": { password: "5678", role: "minjust", name: "Министерство Юстиции" },
    "president": { password: "abcd", role: "president", name: "Президент РФ" },
  };

  // Массив документов (хранится в памяти)
  const documents = [];

  // Массив логов
  const logs = [];

  // Текущий пользователь
  let currentUser = null;

  // Элементы DOM
  const loginSection = document.getElementById('loginSection');
  const mainSection = document.getElementById('mainSection');
  const userNameSpan = document.getElementById('userName');
  const userRoleSpan = document.getElementById('userRole');
  const logoutBtn = document.getElementById('logoutBtn');

  const createDocSection = document.getElementById('createDocSection');
  const fioInput = document.getElementById('fioInput');
  const departmentInput = document.getElementById('departmentInput');
  const docTypeSelect = document.getElementById('docTypeSelect');
  const docNameInput = document.getElementById('docNameInput');
  const docDescInput = document.getElementById('docDescInput');
  const fileInput = document.getElementById('fileInput');
  const uploadDocBtn = document.getElementById('uploadDocBtn');
  const uploadCode = document.getElementById('uploadCode');

  const docsList = document.getElementById('docsList');

  const logsSection = document.getElementById('logsSection');
  const logsList = document.getElementById('logsList');

  // Логин
  document.getElementById('loginBtn').onclick = () => {
    const login = document.getElementById('loginInput').value.trim();
    const password = document.getElementById('passwordInput').value.trim();

    if (!(login in ACCOUNTS)) {
      alert('Неверный логин');
      return;
    }
    if (ACCOUNTS[login].password !== password) {
      alert('Неверный пароль');
      return;
    }

    currentUser = { login, ...ACCOUNTS[login] };
    loginSection.classList.add('hidden');
    mainSection.classList.remove('hidden');

    userNameSpan.textContent = currentUser.name;
    userRoleSpan.textContent = currentUser.role;

    uploadCode.textContent = "";
    fioInput.value = "";
    departmentInput.value = "";
    docNameInput.value = "";
    docDescInput.value = "";
    fileInput.value = "";

    setupUIForRole();
    renderDocuments();
    renderLogs();
  };

  logoutBtn.onclick = () => {
    currentUser = null;
    loginSection.classList.remove('hidden');
    mainSection.classList.add('hidden');
  };

  // Настройка UI по роли
  function setupUIForRole() {
    // Создатель (Правительство РФ) и Президент могут создавать документы
    if (currentUser.role === 'creator' || currentUser.role === 'president') {
      createDocSection.classList.remove('hidden');
    } else {
      createDocSection.classList.add('hidden');
    }

    // Минюст и Президент видят логи
    if (currentUser.role === 'minjust' || currentUser.role === 'president') {
      logsSection.classList.remove('hidden');
    } else {
      logsSection.classList.add('hidden');
    }
  }

  // Загрузка документа
  uploadDocBtn.onclick = () => {
    const fio = fioInput.value.trim();
    const department = departmentInput.value.trim();
    const docType = docTypeSelect.value;
    const docName = docNameInput.value.trim();
    const docDesc = docDescInput.value.trim();

    if (fio.split(' ').length !== 3) {
      alert('ФИО должно содержать 3 слова');
      return;
    }
    if (!department) {
      alert('Введите отдел');
      return;
    }
    if (!docName) {
      alert('Введите название документа');
      return;
    }
    if (!fileInput.files.length) {
      alert('Выберите файл');
      return;
    }

    const file = fileInput.files[0];
    const docId = 'DOC-' + Math.floor(Math.random() * 100000);

    // Создаем "спецкод" для документа
    const specialCode = `${docName} №${docId}`;

    // Добавляем документ в память
    documents.push({
      id: docId,
      fio,
      department,
      docType,
      docName,
      docDesc,
      fileName: file.name,
      fileURL: URL.createObjectURL(file), // для простоты создаем URL из файла
      status: 'Ожидает одобрения',
      createdBy: currentUser.login,
      decisionBy: null,
      decisionDate: null,
      specialCode,
    });

    // Логируем создание
    logs.push({
      timestamp: new Date(),
      user: currentUser.name,
      action: `Создан документ ${docName} (${docId})`,
    });

    alert(`Документ зарегистрирован!\nКод для указа: ${specialCode}`);

    // Очистка формы
    fioInput.value = '';
    departmentInput.value = '';
    docNameInput.value = '';
    docDescInput.value = '';
    fileInput.value = '';
    uploadCode.textContent = '';

    renderDocuments();
    renderLogs();
  };

  // Отрисовка документов
  function renderDocuments() {
    docsList.innerHTML = '';

    if (documents.length === 0) {
      docsList.textContent = 'Документов нет.';
      return;
    }

    documents.forEach(doc => {
      const div = document.createElement('div');
      div.className = 'doc';

      div.innerHTML = `
        <b>${doc.docType}:</b> ${doc.docName} <br/>
        <b>ФИО:</b> ${doc.fio} <br/>
        <b>Отдел:</b> ${doc.department} <br/>
        <b>Описание:</b> ${doc.docDesc || '-'} <br/>
        <b>Файл:</b> <a href="${doc.fileURL}" target="_blank">${doc.fileName}</a> <br/>
        <b>Статус:</b> ${doc.status} <br/>
        <b>Код документа:</b> ${doc.specialCode} <br/>
        <b>Создал:</b> ${ACCOUNTS[doc.createdBy]?.name || doc.createdBy} <br/>
        ${doc.decisionBy ? `<b>Решение:</b> ${doc.status} пользователем ${doc.decisionBy} (${new Date(doc.decisionDate).toLocaleString()})` : ''}
      `;

      // Кнопки для ролей

      // Правительство РФ - только создание, кнопок нет
      if (currentUser.role === 'creator') {
        // нет кнопок
      }

      // Минюст - может одобрять, отклонять, удалять
      if (currentUser.role === 'minjust') {
        const btnApprove = document.createElement('button');
        btnApprove.textContent = 'Одобрить';
        btnApprove.onclick = () => updateDocStatus(doc.id, 'Одобрен');
        const btnReject = document.createElement('button');
        btnReject.textContent = 'Отклонить';
        btnReject.onclick = () => updateDocStatus(doc.id, 'Отклонён');
        const btnDelete = document.createElement('button');
        btnDelete.textContent = 'Удалить';
        btnDelete.onclick = () => deleteDocument(doc.id);
        const btnsDiv = document.createElement('div');
        btnsDiv.className = 'admin-buttons';
        btnsDiv.append(btnApprove, btnReject, btnDelete);
        div.appendChild(btnsDiv);
      }

      // Президент - полный доступ
      if (currentUser.role === 'president') {
        const btnApprove = document.createElement('button');
        btnApprove.textContent = 'Одобрить';
        btnApprove.onclick = () => updateDocStatus(doc.id, 'Одобрен');
        const btnReject = document.createElement('button');
        btnReject.textContent = 'Отклонить';
        btnReject.onclick = () => updateDocStatus(doc.id, 'Отклонён');
        const btnDelete = document.createElement('button');
        btnDelete.textContent = 'Удалить';
        btnDelete.onclick = () => deleteDocument(doc.id);
        const btnsDiv = document.createElement('div');
        btnsDiv.className = 'admin-buttons';
        btnsDiv.append(btnApprove, btnReject, btnDelete);
        div.appendChild(btnsDiv);
      }

      docsList.appendChild(div);
    });
  }

  // Обновление статуса документа (одобрить / отклонить)
  function updateDocStatus(docId, newStatus) {
    const doc = documents.find(d => d.id === docId);
    if (!doc) return;

    doc.status = newStatus;
    doc.decisionBy = currentUser.name;
    doc.decisionDate = new Date();

    logs.push({
      timestamp: new Date(),
      user: currentUser.name,
      action: `Документ ${doc.docName} (${doc.id}) - статус изменён на "${newStatus}"`,
    });

    renderDocuments();
    renderLogs();
  }

  // Удаление документа
  function deleteDocument(docId) {
    const docIndex = documents.findIndex(d => d.id === docId);
    if (docIndex === -1) return;

    logs.push({
      timestamp: new Date(),
      user: currentUser.name,
      action: `Документ ${documents[docIndex].docName} (${docId}) удалён`,
    });

    documents.splice(docIndex, 1);
    renderDocuments();
    renderLogs();
  }

  // Отрисовка логов
  function renderLogs() {
    logsList.innerHTML = '';
    if (logs.length === 0) {
      logsList.textContent = 'Логи пусты.';
      return;
    }

    logs.forEach(log => {
      const div = document.createElement('div');
      div.className = 'log-entry';
      div.textContent = `[${new Date(log.timestamp).toLocaleString()}] ${log.user}: ${log.action}`;
      logsList.appendChild(div);
    });
  }

</script>

</body>
</html>
